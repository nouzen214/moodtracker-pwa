<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoodTracker - Admin Dashboard</title>
    <link rel="stylesheet" href="style.css?v=3">
</head>

<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <div>
                <h1>ğŸ‘¨â€ğŸ’¼ Admin Dashboard</h1>
                <p id="adminGreeting">Manage Users</p>
            </div>
            <button onclick="auth.signOut()" class="btn-danger">ğŸšª Sign Out</button>
        </div>

        <!-- Users List -->
        <div class="calendar-container">
            <h2>ğŸ“‹ Assigned Users</h2>
            <div id="usersList" style="margin-top: 20px;">
                <p>Loading users...</p>
            </div>
        </div>
    </div>

    <script src="api.js?v=3"></script>
    <script>
        // Check authentication and role
        if (!auth.isAuthenticated() || auth.getRole() !== 'admin') {
            window.location.href = 'index.html';
        }

        // Set greeting
        const email = localStorage.getItem('userEmail');
        document.getElementById('adminGreeting').textContent = `Welcome, Admin ${email}!`;

        // Load users
        async function loadUsers() {
            try {
                const result = await admin.getAllUsers();
                displayUsers(result.users || {});
            } catch (error) {
                document.getElementById('usersList').innerHTML =
                    `<p style="color: var(--danger);">Error loading users: ${error.message}</p>`;
            }
        }

        function displayUsers(users) {
            const container = document.getElementById('usersList');

            if (Object.keys(users).length === 0) {
                container.innerHTML = '<p>No users assigned yet.</p>';
                return;
            }

            let html = '<div style="display: grid; gap: 15px;">';

            Object.entries(users).forEach(([uid, userData]) => {
                html += `
                    <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: var(--shadow);">
                        <h3 style="color: var(--primary); margin-bottom: 10px;">
                            ğŸ‘¤ ${userData.fullname || 'Unknown'}
                        </h3>
                        <p><strong>Email:</strong> ${userData.email || 'N/A'}</p>
                        <p><strong>Role:</strong> ${userData.role || 'user'}</p>
                        <p><strong>UID:</strong> ${uid}</p>
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <button onclick="viewUserMoods('${uid}')" class="btn-secondary">
                                ğŸ“Š View Moods
                            </button>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        async function viewUserMoods(uid) {
            alert(`Viewing moods for user ${uid}\n\nThis feature shows the user's mood history. You can implement detailed mood viewing by calling the backend API with the user's UID.`);
        }

        // Initialize
        loadUsers();
    </script>
</body>

</html>